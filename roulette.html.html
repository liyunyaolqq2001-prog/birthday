<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æˆ‘ä»¬å»å“ªå„¿</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --text-color: #333;
            --active-color: #222;
            --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            padding-top: 20px;
        }

        /* é¡¶éƒ¨åˆ‡æ¢æ  */
        .tab-container {
            display: flex; background: #fff; padding: 5px; border-radius: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05); margin-bottom: 30px; /* å¢åŠ åº•éƒ¨é—´è· */
            position: relative; z-index: 50; width: 90%; max-width: 380px;
            justify-content: space-between;
        }
        .tab-btn {
            flex: 1; padding: 10px 0; border-radius: 25px; border: none;
            background: transparent; font-size: 0.9rem; font-weight: bold;
            color: #999; cursor: pointer; transition: all 0.3s; text-align: center;
        }
        .tab-btn.active { background: var(--active-color); color: #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }

        /* æ ‡é¢˜ (å»æ‰äº†è‹±æ–‡å‰¯æ ‡é¢˜ï¼Œé«˜åº¦å‡å°) */
        .header { text-align: center; margin-bottom: 25px; height: 40px;}
        .header h1 { font-size: 1.8rem; font-weight: 700; color: #222; }
        
        /* è½¬ç›˜åŒº */
        .wheel-wrapper {
            position: relative; width: 320px; height: 320px; display: flex;
            justify-content: center; align-items: center; background: #fff;
            border-radius: 50%; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 10px; transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .pointer-container { position: absolute; top: -20px; left: 50%; transform: translateX(-50%); z-index: 20; }
        .pointer-head {
            width: 0; height: 0; border-left: 12px solid transparent;
            border-right: 12px solid transparent; border-top: 20px solid #fff;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2));
        }
        canvas { border-radius: 50%; transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1); }
        .center-btn {
            position: absolute; width: 76px; height: 76px; background: #fff;
            border-radius: 50%; z-index: 10; display: flex; justify-content: center;
            align-items: center; color: #333; font-weight: bold; font-size: 1.1rem;
            cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            transition: transform 0.2s;
        }
        .center-btn:active { transform: scale(0.95); }

        /* ç»“æœé¢æ¿ (å¼¹çª—) - å»æ‰äº†ä¸éœ€è¦çš„å…ƒç´  */
        .result-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 100;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .result-overlay.show { opacity: 1; pointer-events: auto; }

        .result-card {
            background: #fff; width: 85%; max-width: 340px;
            border-radius: 20px; padding: 35px 20px; text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            transform: scale(0.8); transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .result-overlay.show .result-card { transform: scale(1); }

        /* ç»“æœåç§°å­—ä½“åŠ å¤§ */
        .res-name { font-size: 2.2rem; font-weight: 800; color: #222; margin-bottom: 30px; line-height: 1.2; }
        
        /* ä¸¤ä¸ªé€‰é¡¹æŒ‰é’® */
        .action-btns { display: flex; gap: 15px; justify-content: center; }
        .btn-opt {
            flex: 1; padding: 15px 0; border-radius: 12px; font-size: 1rem; font-weight: bold; cursor: pointer; border: none; transition: all 0.2s;
        }
        .btn-keep { background: #f0f2f5; color: #666; }
        .btn-keep:active { background: #e0e2e5; }
        .btn-go { background: #222; color: #fff; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .btn-go:active { transform: scale(0.98); box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

    </style>
</head>
<body>

    <div class="tab-container">
        <button class="tab-btn active" onclick="switchMode('eat')">ğŸ½ï¸ åƒä»€ä¹ˆ</button>
        <button class="tab-btn" onclick="switchMode('drink')">ğŸ¸ å–ä»€ä¹ˆ</button>
        <button class="tab-btn" onclick="switchMode('play')">ğŸ¡ å»å“ªç©</button>
    </div>

    <div class="header">
        <h1 id="page-title">æˆ‘ä»¬åƒä»€ä¹ˆ</h1>
        </div>

    <div class="wheel-wrapper" id="wheel-wrapper">
        <div class="pointer-container"><div class="pointer-head"></div></div>
        <canvas id="wheelCanvas" width="600" height="600" style="width: 300px; height: 300px;"></canvas>
        <div class="center-btn" onclick="spin()">GO</div>
    </div>

    <div class="result-overlay" id="result-overlay">
        <div class="result-card">
            <div class="res-name" id="res-name">...</div>
            <div class="action-btns">
                <button class="btn-opt btn-keep" onclick="handleDecision(false)">å†çœ‹çœ‹</button>
                <button class="btn-opt btn-go" onclick="handleDecision(true)">å°±å»è¿™!</button>
            </div>
        </div>
    </div>

    <script>
        // ================= æ•°æ®åŒº (ç§»é™¤äº† coord å±æ€§) =================

        const DATA_EAT = [
            { name: "ï¼ˆ6ï¼Œ12ï¼‰",    weight: 50, color: "#FF6B6B" },
            { name: "ï¼ˆ6ï¼Œ10ï¼‰",    weight: 50, color: "#FF9F43" },
            { name: "ï¼ˆ2ï¼Œ7ï¼‰",     weight: 50, color: "#FECA57" },
            { name: "ï¼ˆ6ï¼Œ2ï¼‰",     weight: 50, color: "#1DD1A1" },
            { name: "ï¼ˆ6ï¼Œ1ï¼‰",     weight: 50, color: "#48DBFB" },
            { name: "ï¼ˆ8ï¼Œ9ï¼‰",     weight: 50, color: "#54A0FF" },
            { name: "æŸ´ç±³å¤š",        weight: 50, color: "#5F27CD" },
            { name: "å°–ä¸œè½¦ä»”é¢",     weight: 50, color: "#FF9FF3" }
        ];

        const DATA_DRINK = [
            { name: "ï¼ˆ9ï¼Œ5ï¼‰",      weight: 50, color: "#ff4757" },
            { name: "ï¼ˆ11ï¼Œ7ï¼‰",     weight: 50, color: "#ffa502" },
            { name: "è·³æµ·hood",      weight: 50, color: "#2ed573" },
            { name: "ç”²æ¿DECK",      weight: 50, color: "#1e90ff" },
            { name: "åä¸‰é‚€å°é…’é¦†",   weight: 50, color: "#3742fa" },
            { name: "U9U10é…‰é…’é…‰é£Ÿ", weight: 50, color: "#747d8c" },
            { name: "zerzer bar",    weight: 50, color: "#ff7f50" }
        ];

        const DATA_PLAY = [
            { name: "å°„ç®­è®­ç»ƒåœº",    weight: 50, color: "#ef5777" }, 
            { name: "naiveç†æƒ³å›½",   weight: 50, color: "#575fcf" }, 
            { name: "aâ¡zå’–å•¡åº—",    weight: 50, color: "#4bcffa" }, 
            { name: "TIENSTIENSå°†å°†",weight: 50, color: "#34e7e4" }, 
            { name: "é˜¿æ‘çƒ˜ç„™",      weight: 50, color: "#0be881" }, 
            { name: "å®¿å’•XXSHOKU",   weight: 50, color: "#f53b57" }, 
            { name: "FRUITYSHOP",    weight: 50, color: "#3c40c6" }, 
            { name: "hyphen",        weight: 50, color: "#0fbcf9" }, 
            { name: "å­¤ç‹¬å›¾ä¹¦é¦†",     weight: 50, color: "#00d8d6" }, 
            { name: "UCCAæ²™ä¸˜",      weight: 50, color: "#05c46b" }, 
            { name: "åå¤è‰¯å­",      weight: 50, color: "#ffc048" }, 
            { name: "æ˜ŸæœŸäºŒå°å–éƒ¨",   weight: 50, color: "#ffdd59" }, 
            { name: "å¥½ç™½å•†åº—",      weight: 50, color: "#FFD700" }, 
            { name: "DOE",           weight: 50, color: "#8E44AD" }, 
            { name: "CRYING CENTER", weight: 50, color: "#FF00FF" }  
        ];

        // ä¸Šå¸æ¨¡å¼è®¾ç½® (å¡«ç´¢å¼•æ•°å­—ï¼Œ-1ä¸ºéšæœº)
        const FORCE_EAT_INDEX = -1;  
        const FORCE_DRINK_INDEX = -1; 
        const FORCE_PLAY_INDEX = -1; 

        // ================= é€»è¾‘åŒº =================

        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const size = 600; 
        const center = size / 2;
        const radius = size / 2;
        
        let currentMode = 'eat'; 
        let currentData = DATA_EAT; 
        let currentRotation = 0; 
        let hasSpun = { eat: false, drink: false, play: false };
        let lastTargetIndex = -1; 

        [DATA_EAT, DATA_DRINK, DATA_PLAY].forEach(dataset => {
            dataset.forEach(item => item.eliminated = false);
        });

        function switchMode(mode) {
            if (currentMode === mode) return;
            currentMode = mode;
            if (mode === 'eat') currentData = DATA_EAT;
            else if (mode === 'drink') currentData = DATA_DRINK;
            else if (mode === 'play') currentData = DATA_PLAY;
            
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const titleEl = document.getElementById('page-title');
            // ç§»é™¤äº†å¯¹ subTitleEl çš„æ“ä½œ
            if (mode === 'eat') { titleEl.innerText = "æˆ‘ä»¬åƒä»€ä¹ˆ"; } 
            else if (mode === 'drink') { titleEl.innerText = "æˆ‘ä»¬å–ä»€ä¹ˆ"; } 
            else { titleEl.innerText = "æˆ‘ä»¬å»å“ªç©"; }

            document.getElementById('result-overlay').classList.remove('show');
            
            const wrapper = document.getElementById('wheel-wrapper');
            wrapper.style.transform = 'scale(0.9)';
            setTimeout(() => { drawWheel(); wrapper.style.transform = 'scale(1)'; }, 200);
        }

        function drawWheel() {
            ctx.clearRect(0,0, size, size);
            const count = currentData.length;
            const arcSize = (2 * Math.PI) / count; 
            let startAngle = -Math.PI / 2 - (arcSize / 2); 
            currentData.forEach((loc, i) => {
                const endAngle = startAngle + arcSize;
                ctx.beginPath(); ctx.moveTo(center, center);
                ctx.arc(center, center, radius, startAngle, endAngle);
                ctx.fillStyle = loc.color; ctx.fill();
                startAngle = endAngle;
            });
        }
        drawWheel();

        function getWinningIndex() {
            let forceIndex = -1;
            if (currentMode === 'eat') forceIndex = FORCE_EAT_INDEX;
            if (currentMode === 'drink') forceIndex = FORCE_DRINK_INDEX;
            if (currentMode === 'play') forceIndex = FORCE_PLAY_INDEX;

            if (!hasSpun[currentMode] && forceIndex >= 0 && forceIndex < currentData.length && !currentData[forceIndex].eliminated) {
                return forceIndex;
            }

            let availableIndices = [];
            currentData.forEach((item, index) => {
                if (!item.eliminated) availableIndices.push(index);
            });

            if (availableIndices.length === 0) {
                alert("æ‰€æœ‰é€‰é¡¹éƒ½å·²å»è¿‡ï¼è¯·åˆ·æ–°é¡µé¢é‡ç½®ã€‚");
                return -1;
            }

            let randomIndex = Math.floor(Math.random() * availableIndices.length);
            return availableIndices[randomIndex];
        }

        function spin() {
            const btn = document.querySelector('.center-btn');
            const overlay = document.getElementById('result-overlay');
            if(btn.style.pointerEvents === 'none') return;
            
            const targetIndex = getWinningIndex();
            if (targetIndex === -1) return;

            btn.style.pointerEvents = 'none'; 
            overlay.classList.remove('show');
            lastTargetIndex = targetIndex;

            const count = currentData.length; 
            const sliceDeg = 360 / count;     
            
            const randomOffset = Math.floor(Math.random() * (sliceDeg * 0.6)) - (sliceDeg * 0.3);
            const rounds = 360 * (6 + Math.floor(Math.random() * 3)); 
            const targetRotationFromZero = -(targetIndex * sliceDeg) + randomOffset;
            
            const currentMod = currentRotation % 360;
            let dist = targetRotationFromZero - currentMod;
            while (dist < 0) dist += 360; dist += rounds;
            
            currentRotation += dist;
            canvas.style.transform = `rotate(${currentRotation}deg)`;

            setTimeout(() => {
                showResult(currentData[targetIndex]);
                btn.style.pointerEvents = 'auto'; 
                hasSpun[currentMode] = true; 
            }, 4000); 
        }

        function showResult(location) {
            const overlay = document.getElementById('result-overlay');
            const nameEl = document.getElementById('res-name');
            // ç§»é™¤äº† coordEl çš„æ“ä½œ
            nameEl.innerText = location.name; 
            // ç§»é™¤äº† coordEl çš„èµ‹å€¼
            overlay.classList.add('show');
            if (navigator.vibrate) navigator.vibrate(100);
        }

        function handleDecision(goNow) {
            const overlay = document.getElementById('result-overlay');
            overlay.classList.remove('show');

            if (goNow) {
                if (lastTargetIndex !== -1) {
                    currentData[lastTargetIndex].eliminated = true;
                    console.log("Excluded:", currentData[lastTargetIndex].name);
                }
            }
        }
    </script>
</body>
</html>